name: Sunu Blue Tech - PÃªche Copernicus Dakar ğŸ›°ï¸ğŸ£

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 */6 * * *'  # Toutes les 6h
  workflow_dispatch:  # Manuel

jobs:
  copernicus-fishing:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: ğŸ“¦ Installer TOUTES dÃ©pendances Copernicus
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
        pip install openeo==0.12.0 sentinelsat==1.3.0 earthaccess==0.10.2
        echo "âœ… Copernicus libraries OK"
    
    - name: ğŸ”‘ Configurer Credentials Copernicus
      env:
        CDSE_CLIENT_ID: ${{ secrets.CDSE_CLIENT_ID }}
        CDSE_CLIENT_SECRET: ${{ secrets.CDSE_CLIENT_SECRET }}
        SH_CLIENT_ID: ${{ secrets.SH_CLIENT_ID }}
        SH_CLIENT_SECRET: ${{ secrets.SH_CLIENT_SECRET }}
      run: |
        echo "CDSE_CLIENT_ID=${{ secrets.CDSE_CLIENT_ID }}" >> $GITHUB_ENV
        echo "CDSE_CLIENT_SECRET=${{ secrets.CDSE_CLIENT_SECRET }}" >> $GITHUB_ENV
        echo "Credentials dÃ©tectÃ©s: $([ ! -z '$CDSE_CLIENT_ID' ] && echo 'âœ…' || echo 'âŒ')"
    
    - name: ğŸ£ Lancer PÃªche Copernicus Dakar
      run: |
        python fishing_script.py
        echo "ğŸ“Š RÃ©sultats:"
        cat copernicus_results.json || echo "Fichier crÃ©Ã©"
    
    - name: ğŸ“¤ Upload rÃ©sultats JSON
      uses: actions/upload-artifact@v4
      with:
        name: copernicus-dakar-results
        path: |
          copernicus_results.json
          copernicus_debug.log
    
    - name: ğŸ”” Notification Discord (optionnel)
      if: always()
      uses: Ilshidur/action-discord@master
      with:
        args: 'ğŸš¤ Sunu Blue Tech {{ github.repository }} - ${{ job.status }} - ${{ github.run_number }}'
