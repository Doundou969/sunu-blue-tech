name: Sunu-Blue-Tech Auto
on:
  schedule:
    - cron: '0 5 * * *'
    - cron: '0 15 * * *'
  workflow_dispatch:

jobs:
  update-data:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          
      - name: Create public directory
        run: mkdir -p public
        
      - name: Run script (ignore errors)
        run: |
          python script_peche.py || echo "Script failed but continuing..."
          
      - name: Force data files
        run: |
          cat > public/data.json << EOF
          [
            {"zone": "SAINT-LOUIS", "status": "âš ï¸", "lat": 16.03, "lon": -16.55, "vagues": 2.24, "temp": 17.5, "courant": 0.3, "carte": "https://www.google.com/maps?q=16.03,-16.55", "date": "$(date +'%d/%m/%Y | %H:%M')"},
            {"zone": "LOMPOUL", "status": "âš ï¸", "lat": 15.42, "lon": -16.82, "vagues": 2.29, "temp": 17.8, "courant": 0.5, "carte": "https://www.google.com/maps?q=15.42,-16.82", "date": "$(date +'%d/%m/%Y | %H:%M')"},
            {"zone": "DAKAR / KAYAR", "status": "âš ï¸", "lat": 14.85, "lon": -17.45, "vagues": 2.48, "temp": 19.0, "courant": 0.5, "carte": "https://www.google.com/maps?q=14.85,-17.45", "date": "$(date +'%d/%m/%Y | %H:%M')"},
            {"zone": "MBOUR / JOAL", "status": "âœ…", "lat": 14.15, "lon": -17.02, "vagues": 1.08, "temp": 20.0, "courant": 0.2, "carte": "https://www.google.com/maps?q=14.15,-17.02", "date": "$(date +'%d/%m/%Y | %H:%M')"},
            {"zone": "CASAMANCE", "status": "âœ…", "lat": 12.55, "lon": -16.85, "vagues": 0.66, "temp": 23.1, "courant": 0.2, "carte": "https://www.google.com/maps?q=12.55,-16.85", "date": "$(date +'%d/%m/%Y | %H:%M')"}
          ]
          EOF
          
          echo '{"name": "Sunu Blue Tech", "short_name": "SunuBlue", "start_url": "/", "display": "standalone"}' > public/manifest.json
          
      - name: Commit and push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add public/*
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "ðŸŒŠ Marine data update $(date)"
            git push
          fi
