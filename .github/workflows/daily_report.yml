name: Daily Report

on:
  schedule:
    # Exécute tous les jours à 8h00 UTC (ajustez selon vos besoins)
    - cron: '0 8 * * *'
  workflow_dispatch:  # Permet de déclencher manuellement

jobs:
  generate-report:
    runs-on: ubuntu-latest
    
    steps:
      # Étape 1: Checkout du code
      - name: Checkout repository
        uses: actions/checkout@v4
      
      # Étape 2: Setup de l'environnement (exemple Python)
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      # Étape 3: Installation des dépendances
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      # Étape 4: Génération du rapport
      - name: Generate daily report
        run: |
          python generate_report.py
      
      # Étape 5: Upload du rapport comme artifact
      - name: Upload report
        uses: actions/upload-artifact@v4
        with:
          name: daily-report-${{ github.run_number }}
          path: report_*.pdf  # ou report_*.html, etc.
          retention-days: 30
      
      # Étape 6: Notification (optionnel)
      - name: Notify team
        if: always()
        uses: 0479/simple-weather-notify@v1.1.2
        with:
          bot_token: ${{ secrets.BOT_TOKEN }}
          chat_id: ${{ secrets.CHAT_ID }}
          text: "Rapport quotidien terminé: ${{ job.status }}"
