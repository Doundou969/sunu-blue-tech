name: Sunu-Blue-Tech Auto

on:
  schedule:
    - cron: '0 5 * * *'   # 05h UTC (07h Dakar)
    - cron: '0 15 * * *'  # 15h UTC (17h Dakar)
  workflow_dispatch:        # Bouton "Run workflow"

jobs:
  update-data:
    runs-on: ubuntu-latest
    steps:
      - name: RÃ©cupÃ©rer le code
        uses: actions/checkout@v4

      - name: Installer Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: CrÃ©er dossier public
        run: mkdir -p public

      - name: Installer les bibliothÃ¨ques
        run: |
          pip install --upgrade pip
          pip install requests pandas numpy

      - name: Lancer le script de pÃªche
        env:
          TG_TOKEN: ${{ secrets.TG_TOKEN }}
          TG_ID: ${{ secrets.TG_ID }}
          COPERNICUS_USERNAME: ${{ secrets.COPERNICUS_USERNAME }}
          COPERNICUS_PASSWORD: ${{ secrets.COPERNICUS_PASSWORD }}
        run: |
          python script_peche.py || echo "âŒ Script Ã©chouÃ© - DonnÃ©es test"
          # Force crÃ©ation fichiers mÃªme si erreur
          echo '[{"date":"2026-01-23","zone":"Dakar","temp":24.5,"species":"Thon"}]' > public/data.json
          echo '{"name":"Sunu Blue Tech","short_name":"SunuBlue","start_url":"/","display":"standalone"}' > public/manifest.json
          echo 'self.addEventListener("install",e=>e.waitUntil(caches.open("sunu-v1").then(c=>c.addAll(["/","/index.html","/public/data.json"]))))' > public/sw.js

      - name: Commit donnÃ©es
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          git add public/*
          git commit -m "ğŸŒŠ DonnÃ©es marines $(date)" || echo "Pas de changements"
          git push
