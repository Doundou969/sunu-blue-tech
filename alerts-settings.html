<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0056b3">
    <title>Param√®tres Alertes - PecheurConnect v3.0 üá∏üá≥</title>
    
    <link rel="manifest" href="./manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #0056b3;
            --primary-dk: #003d7a;
            --safe: #00c853;
            --bg: #f0f4f8;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg);
            min-height: 100vh;
        }
        
        /* TOPBAR */
        .topbar {
            background: linear-gradient(135deg, var(--primary), var(--primary-dk));
            padding: 0 30px;
            box-shadow: 0 4px 20px rgba(0,86,179,0.3);
        }
        
        .topbar-inner {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }
        
        .topbar-brand {
            font-family: 'Syne', sans-serif;
            font-size: 20px;
            font-weight: 800;
            color: white;
            text-decoration: none;
        }
        
        /* PAGE */
        .page {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .card {
            background: white;
            border-radius: 14px;
            padding: 30px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }
        
        h1 {
            font-family: 'Syne', sans-serif;
            font-size: 32px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #888;
            font-size: 15px;
            margin-bottom: 30px;
        }
        
        /* SECTION */
        .section {
            margin: 30px 0;
            padding: 24px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .section h3 {
            font-family: 'Syne', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 18px;
        }
        
        /* TOGGLE */
        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid #e8ecf0;
        }
        
        .toggle-row:last-child {
            border-bottom: none;
        }
        
        .toggle-label {
            flex: 1;
        }
        
        .toggle-label strong {
            display: block;
            font-size: 15px;
            color: #333;
            margin-bottom: 4px;
        }
        
        .toggle-label span {
            font-size: 13px;
            color: #888;
        }
        
        /* SWITCH */
        .switch {
            position: relative;
            width: 56px;
            height: 30px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: #ccc;
            transition: 0.3s;
            border-radius: 30px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background: var(--safe);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* ZONE SELECT */
        .zone-select {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 16px;
        }
        
        .zone-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: white;
            border: 2px solid #e8ecf0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .zone-checkbox:hover {
            border-color: var(--primary);
            background: #f0f7ff;
        }
        
        .zone-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .zone-checkbox label {
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            flex: 1;
        }
        
        /* BUTTON */
        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 30px;
            font-family: 'DM Sans', sans-serif;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 16px rgba(0,86,179,0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,86,179,0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-test {
            background: #ff9800;
            color: white;
        }
        
        /* STATUS */
        .status-box {
            background: #e3f2fd;
            border-left: 4px solid var(--primary);
            padding: 16px 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .status-box strong {
            color: var(--primary);
            font-size: 14px;
        }
        
        .status-box p {
            margin-top: 8px;
            font-size: 13px;
            color: #555;
        }
        
        @media (max-width: 768px) {
            .page { padding: 16px 12px; }
            .card { padding: 20px; }
            h1 { font-size: 24px; }
            .zone-select {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<div class="topbar">
    <div class="topbar-inner">
        <a href="./index.html" class="topbar-brand">üåä PecheurConnect</a>
        <a href="./index.html" style="color: rgba(255,255,255,0.8); text-decoration: none; font-size: 13px;">‚Üê Retour</a>
    </div>
</div>

<div class="page">
    <div class="card">
        <h1>üîî Param√®tres des Alertes</h1>
        <p class="subtitle">Configurez vos notifications personnalis√©es</p>
        
        <div class="status-box" id="statusBox" style="display:none;">
            <strong id="statusTitle">‚úÖ Alertes activ√©es</strong>
            <p id="statusText">Vous recevrez des notifications selon vos pr√©f√©rences.</p>
        </div>
        
        <!-- Activation -->
        <div class="section">
            <h3>üîî Activer les notifications</h3>
            <div class="toggle-row">
                <div class="toggle-label">
                    <strong>Recevoir des alertes push</strong>
                    <span>Notifications en temps r√©el sur votre appareil</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="enableAlerts" onchange="toggleAlerts(this)">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <!-- Types -->
        <div class="section">
            <h3>üìã Types d'alertes</h3>
            <div class="toggle-row">
                <div class="toggle-label">
                    <strong>üî¥ Alertes DANGER</strong>
                    <span>Conditions dangereuses - Ne pas sortir</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="alertDanger" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="toggle-row">
                <div class="toggle-label">
                    <strong>üü† Alertes PRUDENCE</strong>
                    <span>Conditions d√©grad√©es - Vigilance accrue</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="alertWarning" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="toggle-row">
                <div class="toggle-label">
                    <strong>üé£ Alertes CONDITIONS OPTIMALES</strong>
                    <span>Parfait pour p√™cher - Bonnes conditions</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="alertOptimal" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="toggle-row">
                <div class="toggle-label">
                    <strong>‚ö†Ô∏è Alertes D√âGRADATION</strong>
                    <span>Quand les conditions se d√©t√©riorent</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="alertDegradation">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <!-- Zones -->
        <div class="section">
            <h3>üìç Zones √† surveiller</h3>
            <p style="color:#888; font-size:13px; margin-bottom:16px;">
                Laissez vide pour surveiller toutes les zones
            </p>
            <div class="zone-select" id="zoneSelect"></div>
        </div>
        
        <!-- Options -->
        <div class="section">
            <h3>‚öôÔ∏è Options</h3>
            <div class="toggle-row">
                <div class="toggle-label">
                    <strong>üîä Son</strong>
                    <span>Jouer un son lors des notifications</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="soundEnabled" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="toggle-row">
                <div class="toggle-label">
                    <strong>üì≥ Vibration</strong>
                    <span>Faire vibrer lors des notifications</span>
                </div>
                <label class="switch">
                    <input type="checkbox" id="vibrationEnabled" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <!-- Actions -->
        <button class="btn btn-test" onclick="testNotification()">
            üß™ Tester une notification
        </button>
        <button class="btn btn-primary" onclick="savePreferences()">
            üíæ Sauvegarder les param√®tres
        </button>
        <a href="./index.html" class="btn btn-secondary" style="text-decoration:none; display:block; text-align:center;">
            ‚Üê Retour √† la carte
        </a>
    </div>
</div>

<script src="./alerts.js"></script>
<script>
const zones = [
    "SAINT-LOUIS", "GANDIOL", "KAYAR", "LOMPOUL",
    "DAKAR-YOFF", "DAKAR-SOUMBEDIOUNE", "DAKAR-HANN", "RUFISQUE", "BARGNY",
    "MBOUR-JOAL", "NIANING", "SALY",
    "PALMARIN", "FOUNDIOUGNE", "MISSIRAH",
    "CASAMANCE-ZIGUINCHOR", "CASAMANCE-CAP-SKIRRING", "KAFOUNTINE"
];

// Remplir zones
const zoneSelect = document.getElementById('zoneSelect');
zones.forEach(zone => {
    const div = document.createElement('div');
    div.className = 'zone-checkbox';
    div.innerHTML = `
        <input type="checkbox" id="zone_${zone.replace(/[- ]/g, '_')}" value="${zone}">
        <label for="zone_${zone.replace(/[- ]/g, '_')}">${zone}</label>
    `;
    zoneSelect.appendChild(div);
});

// Charger pr√©f√©rences
const prefs = alertSystem.loadPreferences();
document.getElementById('enableAlerts').checked = prefs.enabled;
document.getElementById('alertDanger').checked = prefs.conditions.danger;
document.getElementById('alertWarning').checked = prefs.conditions.warning;
document.getElementById('alertOptimal').checked = prefs.conditions.optimal;
document.getElementById('alertDegradation').checked = prefs.conditions.degradation || false;
document.getElementById('soundEnabled').checked = prefs.sound !== false;
document.getElementById('vibrationEnabled').checked = prefs.vibration !== false;

prefs.zones.forEach(zone => {
    const checkbox = document.getElementById(`zone_${zone.replace(/[- ]/g, '_')}`);
    if (checkbox) checkbox.checked = true;
});

updateStatus();

async function toggleAlerts(checkbox) {
    if (checkbox.checked) {
        const granted = await alertSystem.requestPermission();
        if (!granted) {
            checkbox.checked = false;
            alert('‚ùå Vous devez autoriser les notifications dans les param√®tres de votre navigateur.');
        } else {
            alertSystem.startMonitoring();
            updateStatus();
        }
    } else {
        alertSystem.stopMonitoring();
        updateStatus();
    }
}

async function savePreferences() {
    const enabled = document.getElementById('enableAlerts').checked;
    
    if (enabled && Notification.permission !== 'granted') {
        const granted = await alertSystem.requestPermission();
        if (!granted) {
            alert('‚ùå Vous devez autoriser les notifications');
            document.getElementById('enableAlerts').checked = false;
            return;
        }
    }
    
    const selectedZones = Array.from(document.querySelectorAll('.zone-checkbox input:checked'))
        .map(cb => cb.value);
    
    alertSystem.updatePreferences({
        enabled: enabled,
        zones: selectedZones,
        conditions: {
            danger: document.getElementById('alertDanger').checked,
            warning: document.getElementById('alertWarning').checked,
            optimal: document.getElementById('alertOptimal').checked,
            degradation: document.getElementById('alertDegradation').checked
        },
        sound: document.getElementById('soundEnabled').checked,
        vibration: document.getElementById('vibrationEnabled').checked
    });
    
    updateStatus();
    
    alert('‚úÖ Param√®tres sauvegard√©s !');
}

async function testNotification() {
    await alertSystem.testNotification();
}

function updateStatus() {
    const status = alertSystem.getStatus();
    const box = document.getElementById('statusBox');
    const title = document.getElementById('statusTitle');
    const text = document.getElementById('statusText');
    
    box.style.display = 'block';
    
    if (status.enabled && status.permission === 'granted') {
        box.style.background = '#e8f5e9';
        box.style.borderLeftColor = '#00c853';
        title.textContent = '‚úÖ Alertes activ√©es';
        title.style.color = '#2e7d32';
        
        const zones = status.zonesWatched === 'Toutes' ? 'toutes les zones' : `${status.zonesWatched} zone(s)`;
        text.textContent = `Surveillance active sur ${zones}.`;
    } else if (status.enabled && status.permission === 'denied') {
        box.style.background = '#ffebee';
        box.style.borderLeftColor = '#d32f2f';
        title.textContent = '‚ùå Permission refus√©e';
        title.style.color = '#b71c1c';
        text.textContent = 'Activez les notifications dans les param√®tres de votre navigateur.';
    } else {
        box.style.background = '#fff8e1';
        box.style.borderLeftColor = '#ffc107';
        title.textContent = '‚ö™ Alertes d√©sactiv√©es';
        title.style.color = '#f57f17';
        text.textContent = 'Activez les alertes pour recevoir des notifications.';
    }
}
</script>

</body>
</html>
