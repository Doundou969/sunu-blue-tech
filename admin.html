<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - PecheurConnect</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    
    <style>
        :root {
            --primary: #0056b3;
            --danger: #d32f2f;
            --warning: #ff9800;
            --safe: #28a745;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
        }
        
        .header {
            background: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            color: var(--primary);
            font-size: 24px;
        }
        
        .header .time {
            font-size: 14px;
            color: #666;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .kpis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
        }
        
        .kpi-card.danger::before { background: var(--danger); }
        .kpi-card.warning::before { background: var(--warning); }
        .kpi-card.safe::before { background: var(--safe); }
        
        .kpi-title {
            font-size: 13px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }
        
        .kpi-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .kpi-trend {
            font-size: 13px;
            color: #666;
        }
        
        .kpi-trend.up {
            color: var(--safe);
        }
        
        .kpi-trend.down {
            color: var(--danger);
        }
        
        .charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .chart-card h3 {
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .zones-table {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-size: 13px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-safe {
            background: #e8f5e9;
            color: var(--safe);
        }
        
        .status-caution {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .status-warning {
            background: #ffe5d0;
            color: var(--warning);
        }
        
        .status-danger {
            background: #ffebee;
            color: var(--danger);
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>üèõÔ∏è Dashboard National - P√™che Maritime</h1>
            <p style="font-size: 14px; color: #666; margin-top: 5px;">
                Minist√®re de la P√™che et de l'√âconomie Maritime - S√©n√©gal üá∏üá≥
            </p>
        </div>
        <div class="time" id="currentTime"></div>
    </div>
    
    <div class="container">
        <!-- KPIs -->
        <div class="kpis">
            <div class="kpi-card">
                <div class="kpi-title">Zones Actives</div>
                <div class="kpi-value" id="totalZones">18</div>
                <div class="kpi-trend">100% op√©rationnel</div>
            </div>
            
            <div class="kpi-card safe">
                <div class="kpi-title">Zones S√ªres</div>
                <div class="kpi-value" id="safeZones">0</div>
                <div class="kpi-trend" id="safeTrend">Chargement...</div>
            </div>
            
            <div class="kpi-card danger">
                <div class="kpi-title">Alertes Actives</div>
                <div class="kpi-value" id="alerts">0</div>
                <div class="kpi-trend" id="alertTrend">Zones en danger/prudence</div>
            </div>
            
            <div class="kpi-card">
                <div class="kpi-title">Pr√©vision 24h</div>
                <div class="kpi-value" id="forecastStatus">‚úÖ</div>
                <div class="kpi-trend">Conditions stables attendues</div>
            </div>
        </div>
        
        <!-- Graphiques -->
        <div class="charts">
            <div class="chart-card">
                <h3>R√©partition S√©curit√©</h3>
                <canvas id="safetyChart"></canvas>
            </div>
            
            <div class="chart-card">
                <h3>√âvolution 7 Jours</h3>
                <canvas id="trendChart"></canvas>
            </div>
            
            <div class="chart-card">
                <h3>Conditions Moyennes par R√©gion</h3>
                <canvas id="regionChart"></canvas>
            </div>
            
            <div class="chart-card">
                <h3>Alertes Hebdomadaires</h3>
                <canvas id="alertsChart"></canvas>
            </div>
        </div>
        
        <!-- Tableau zones -->
        <div class="zones-table">
            <h3 style="margin-bottom: 20px; color: var(--primary);">√âtat D√©taill√© des Zones</h3>
            <table>
                <thead>
                    <tr>
                        <th>Zone</th>
                        <th>R√©gion</th>
                        <th>Vagues</th>
                        <th>Temp√©rature</th>
                        <th>Vent</th>
                        <th>S√©curit√©</th>
                        <th>P√™che</th>
                        <th>Derni√®re MAJ</th>
                    </tr>
                </thead>
                <tbody id="zonesTableBody"></tbody>
            </table>
        </div>
    </div>
    
    <script>
        let allZones = [];
        
        async function init() {
            updateTime();
            setInterval(updateTime, 1000);
            
            try {
                const response = await fetch('./data.json?v=' + Date.now());
                allZones = await response.json();
                
                updateKPIs();
                createCharts();
                fillZonesTable();
                
                // Refresh toutes les 5 min
                setInterval(async () => {
                    const response = await fetch('./data.json?v=' + Date.now());
                    allZones = await response.json();
                    updateKPIs();
                    fillZonesTable();
                }, 5 * 60 * 1000);
                
            } catch (error) {
                console.error('Erreur:', error);
            }
        }
        
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleString('fr-FR', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
        }
        
        function updateKPIs() {
            const safeCount = allZones.filter(z => z.safety_level === 'safe').length;
            const dangerCount = allZones.filter(z => z.safety_level === 'danger' || z.safety_level === 'warning').length;
            
            document.getElementById('totalZones').textContent = allZones.length;
            document.getElementById('safeZones').textContent = safeCount;
            document.getElementById('safeTrend').textContent = 
                `${Math.round(safeCount / allZones.length * 100)}% des zones`;
            
            document.getElementById('alerts').textContent = dangerCount;
            document.getElementById('alertTrend').textContent = 
                dangerCount === 0 ? 'Aucune alerte' : `${dangerCount} zone(s) √† surveiller`;
        }
        
        function createCharts() {
            // Chart s√©curit√©
            const safetyCounts = {
                safe: allZones.filter(z => z.safety_level === 'safe').length,
                caution: allZones.filter(z => z.safety_level === 'caution').length,
                warning: allZones.filter(z => z.safety_level === 'warning').length,
                danger: allZones.filter(z => z.safety_level === 'danger').length
            };
            
            new Chart(document.getElementById('safetyChart'), {
                type: 'doughnut',
                data: {
                    labels: ['S√ªr', 'Vigilance', 'Prudence', 'Danger'],
                    datasets: [{
                        data: [safetyCounts.safe, safetyCounts.caution, safetyCounts.warning, safetyCounts.danger],
                        backgroundColor: ['#28a745', '#ffc107', '#ff9800', '#d32f2f']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
            
            // Chart r√©gions
            const regions = {};
            allZones.forEach(z => {
                if (!regions[z.region]) {
                    regions[z.region] = { wave: 0, temp: 0, wind: 0, count: 0 };
                }
                regions[z.region].wave += z.v_now;
                regions[z.region].temp += z.t_now;
                regions[z.region].wind += z.wind_speed || 0;
                regions[z.region].count++;
            });
            
            const regionNames = Object.keys(regions);
            const avgWaves = regionNames.map(r => (regions[r].wave / regions[r].count).toFixed(2));
            
            new Chart(document.getElementById('regionChart'), {
                type: 'bar',
                data: {
                    labels: regionNames,
                    datasets: [{
                        label: 'Vagues (m)',
                        data: avgWaves,
                        backgroundColor: '#0056b3'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
            
            // Charts simul√©s (trend et alerts) - √† remplacer par vraies donn√©es
            new Chart(document.getElementById('trendChart'), {
                type: 'line',
                data: {
                    labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
                    datasets: [{
                        label: 'Zones s√ªres',
                        data: [15, 16, 14, 17, 16, 18, safeCount],
                        borderColor: '#28a745',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
            
            new Chart(document.getElementById('alertsChart'), {
                type: 'bar',
                data: {
                    labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
                    datasets: [{
                        label: 'Alertes',
                        data: [2, 1, 3, 0, 1, 0, dangerCount],
                        backgroundColor: '#ff9800'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }
        
        function fillZonesTable() {
            const tbody = document.getElementById('zonesTableBody');
            tbody.innerHTML = '';
            
            allZones.forEach(zone => {
                const row = document.createElement('tr');
                
                const safetyClass = {
                    safe: 'status-safe',
                    caution: 'status-caution',
                    warning: 'status-warning',
                    danger: 'status-danger'
                }[zone.safety_level] || '';
                
                row.innerHTML = `
                    <td><strong>${zone.zone}</strong></td>
                    <td>${zone.region}</td>
                    <td>${zone.v_now}m</td>
                    <td>${zone.t_now}¬∞C</td>
                    <td>${zone.wind_speed || 'N/A'}m/s</td>
                    <td><span class="status-badge ${safetyClass}">${zone.safety_level.toUpperCase()}</span></td>
                    <td>${zone.fish_level}</td>
                    <td>${zone.date} UTC</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        init();
    </script>
</body>
</html>
