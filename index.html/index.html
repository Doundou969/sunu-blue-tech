<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PecheurConnect ðŸ‡¸ðŸ‡³</title>

<link rel="manifest" href="./manifest.json">
<link rel="icon" href="./icon-192.png">

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body { background:#020617; color:white; }
#map { height:320px; border-radius:16px; }
</style>
</head>

<body class="p-4 max-w-4xl mx-auto">

<h1 class="text-center text-3xl font-black text-sky-400 mb-4">
PECHEUR CONNECT ðŸ‡¸ðŸ‡³
</h1>

<div id="map" class="mb-6"></div>
<div id="dashboard" class="grid gap-4"></div>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register("./sw.js");
}

const map = L.map('map').setView([14.7, -17.4], 7);
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

fetch("./data.json?t=" + Date.now())
  .then(r => r.json())
  .then(data => {
    const dash = document.getElementById("dashboard");
    dash.innerHTML = "";
    data.forEach(z => {
      const div = document.createElement("div");
      div.className = "p-4 bg-slate-800 rounded-xl";
      div.innerHTML = `
        <b>${z.zone}</b><br>
        ðŸŒŠ ${z.vhm0} m | ðŸŒ¡ï¸ ${z.temp}Â°C | ${z.alert}
      `;
      dash.appendChild(div);

      if (z.lat && z.lon) {
        L.circleMarker([z.lat, z.lon], {
          radius:10, color:"#fff",
          fillColor: z.vhm0 > 2.2 ? "red" : "cyan",
          fillOpacity:0.8
        }).addTo(map);
      }
    });
  });
</script>
</body>
</html>
