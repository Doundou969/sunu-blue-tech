<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PecheurConnect ðŸ‡¸ðŸ‡³ | Guide de PÃªche Satellite</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body { background-color: #0f172a; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        #map { height: 450px; border-radius: 1.5rem; z-index: 10; border: 2px solid #38bdf8; }
        .leaflet-popup-content-wrapper { background: #1e293b; color: white; border: 1px solid #38bdf8; }
        .leaflet-popup-tip { background: #1e293b; }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="max-w-6xl mx-auto mb-8 text-center">
        <h1 class="text-4xl font-extrabold text-sky-400 tracking-tight">PECHEUR CONNECT ðŸ‡¸ðŸ‡³</h1>
        <p class="text-slate-400 mt-2">Expertise Satellite Copernicus pour la PÃªche Artisanale</p>
        <div id="update-tag" class="text-xs text-slate-500 mt-2 uppercase tracking-widest">Initialisation...</div>
    </header>

    <div class="max-w-6xl mx-auto mb-6 flex justify-center">
        <button onclick="getUserLocation()" class="bg-sky-600 hover:bg-sky-500 text-white font-bold py-4 px-8 rounded-full shadow-lg transition-all transform hover:scale-105 flex items-center gap-3">
            <i class="fas fa-location-crosshairs text-xl"></i>
            TROUVER LA ZONE LA PLUS PROCHE
        </button>
    </div>

    <div class="max-w-6xl mx-auto mb-10">
        <div id="map" class="shadow-2xl"></div>
    </div>

    <div id="dashboard" class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="col-span-full text-center py-10 text-slate-500 italic">
            RÃ©cupÃ©ration des donnÃ©es satellites en cours...
        </div>
    </div>

    <footer class="max-w-6xl mx-auto mt-16 pt-8 border-t border-slate-800 text-center text-slate-500 text-sm pb-10">
        <p class="mb-2">Â© 2026 <b>PecheurConnect</b> - Remplacement officiel de SunuBlueTech</p>
        <p>DonnÃ©es traitÃ©es par l'Intelligence Artificielle & Copernicus Marine Service</p>
    </footer>

    <script>
        // Configuration initiale de la carte centrÃ©e sur le SÃ©nÃ©gal
        const map = L.map('map').setView([14.497, -15.5], 7);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        const coordsZones = {
            "SAINT-LOUIS": [16.03, -16.50],
            "DAKAR-YOFF":  [14.75, -17.48],
            "MBOUR-JOAL":  [14.41, -16.96],
            "CASAMANCE":   [12.50, -16.70]
        };

        let lastData = [];

        async function initApp() {
            try {
                const response = await fetch('data.json?t=' + new Date().getTime());
                lastData = await response.json();
                
                renderDashboard(lastData);
                renderMarkers(lastData);
                
                document.getElementById('update-tag').innerText = "DerniÃ¨re mise Ã  jour : " + new Date().toLocaleString('fr-FR');
            } catch (e) {
                console.error("Erreur de chargement:", e);
                document.getElementById('dashboard').innerHTML = `<p class="col-span-full text-center text-red-400">Impossible de charger les donnÃ©es. VÃ©rifiez que le script a tournÃ©.</p>`;
            }
        }

        function renderMarkers(data) {
            data.forEach(item => {
                const pos = coordsZones[item.zone];
                if (pos) {
                    const color = item.temp < 21 ? "#0ea5e9" : "#f59e0b"; // Bleu si froid (poisson), Orange si chaud
                    const marker = L.circleMarker(pos, {
                        radius: 10,
                        fillColor: color,
                        color: "#fff",
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.8
                    }).addTo(map);

                    marker.bindPopup(`
                        <div class="p-2">
                            <b class="text-lg">${item.zone}</b><br>
                            <span class="text-sky-400 font-bold">${item.temp}Â°C</span> | ðŸŒŠ ${item.vhm || '1.2'}m<br>
                            <p class="mt-1 text-xs italic">${item.target}</p>
                        </div>
                    `);
                }
            });
        }

        function renderDashboard(data) {
            const container = document.getElementById('dashboard');
            container.innerHTML = '';

            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'glass p-6 rounded-2xl border-t-4 ' + (item.temp < 21 ? 'border-sky-500' : 'border-orange-500');
                card.innerHTML = `
                    <h3 class="text-xl font-bold mb-2">${item.zone}</h3>
                    <div class="flex justify-between items-end">
                        <div>
                            <p class="text-3xl font-mono text-white">${item.temp}Â°C</p>
                            <p class="text-xs text-slate-400 uppercase mt-1">TempÃ©rature</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xl font-mono text-sky-300">${item.vhm || '1.2'}m</p>
                            <p class="text-xs text-slate-400 uppercase mt-1">Vagues</p>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-slate-700/50">
                        <p class="text-sm leading-tight text-slate-300"><i class="fas fa-fish mr-2"></i>${item.target}</p>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // --- FONCTIONS GPS ---

        function getUserLocation() {
            if (!navigator.geolocation) {
                alert("Votre navigateur ne supporte pas la gÃ©olocalisation.");
                return;
            }

            navigator.geolocation.getCurrentPosition((position) => {
                const uLat = position.coords.latitude;
                const uLng = position.coords.longitude;

                // Marqueur Pirogue
                L.marker([uLat, uLng], {
                    icon: L.divIcon({className: 'text-3xl', html: 'ðŸš¤'})
                }).addTo(map).bindPopup("<b>Ma Position</b>").openPopup();

                map.setView([uLat, uLng], 9);

                // Calculer le plus proche
                let nearest = null;
                let minDist = Infinity;

                for (const [name, pos] of Object.entries(coordsZones)) {
                    const d = calculateDistance(uLat, uLng, pos[0], pos[1]);
                    if (d < minDist) {
                        minDist = d;
                        nearest = name;
                    }
                }

                alert(`ðŸ“ Votre pirogue est Ã  ${Math.round(minDist)} km de la zone ${nearest}.`);

            }, () => alert("Erreur : GPS dÃ©sactivÃ© ou non autorisÃ©."));
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; 
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat
