<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PecheurConnect ğŸ‡¸ğŸ‡³ | Radar Satellite</title>

<link rel="icon" href="https://img.icons8.com/fluency/48/fish.png">

<!-- TailwindCSS CDN (pour dev rapide) -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<!-- PWA manifest -->
<link rel="manifest" href="manifest.json">

<style>
body { background: #020617; color: white; font-family: system-ui, sans-serif; }
.glass-card { background: rgba(15,23,42,0.8); backdrop-filter: blur(12px); border-radius: 1.5rem; border:1px solid rgba(51,65,85,0.4); }
#map { height: 320px; border-radius:1.5rem; border:2px solid #1e293b; }
.danger-pulse { border:2px solid #ef4444; animation:pulse-red 2s infinite; }
@keyframes pulse-red { 0% { box-shadow:0 0 0 0 rgba(239,68,68,0.6);} 70% { box-shadow:0 0 0 12px rgba(239,68,68,0);} 100% { box-shadow:0 0 0 0 rgba(239,68,68,0);} }
</style>
</head>
<body class="p-4 max-w-4xl mx-auto">

<header class="text-center mb-6 pt-2">
<h1 class="text-3xl font-black text-sky-400 italic">PECHEUR CONNECT ğŸ‡¸ğŸ‡³</h1>
<p class="text-[10px] text-slate-500 font-bold uppercase mt-1">Radar Satellite Copernicus</p>
</header>

<div id="map" class="mb-6 shadow-2xl"></div>

<div class="glass-card p-4 mb-6">
<h4 class="text-sky-400 font-bold text-xs mb-3 flex items-center gap-2">
<i class="fas fa-info-circle"></i> LÃ©gende
</h4>
<div class="grid grid-cols-2 gap-3 text-[11px] font-medium italic">
<div class="flex items-center gap-2"><span>ğŸ“‰</span> <span class="text-slate-300">Upwelling</span></div>
<div class="flex items-center gap-2"><span>ğŸ”´</span> <span class="text-red-400 font-bold">Danger</span></div>
<div class="flex items-center gap-2"><span>ğŸ“ˆ</span> <span class="text-slate-300">Chaud</span></div>
<div class="flex items-center gap-2"><span>ğŸŸ¢</span> <span class="text-emerald-400 font-bold">Calme</span></div>
</div>
</div>

<div class="grid grid-cols-2 gap-3 mb-8">
<button onclick="getUserLocation()" class="bg-sky-600 p-4 rounded-2xl font-bold text-xs flex items-center justify-center gap-2 active:scale-95 transition-transform shadow-lg">
<i class="fas fa-compass"></i> GPS POSITION
</button>
<button onclick="window.open('sms:+221?body=Alerte PecheurConnect : Danger dÃ©tectÃ© en mer !')" class="bg-red-600 p-4 rounded-2xl font-bold text-xs flex items-center justify-center gap-2 active:scale-95 transition-transform shadow-lg">
<i class="fas fa-exclamation-triangle"></i> ALERTE SMS
</button>
</div>

<div id="dashboard" class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="col-span-full text-center py-12">
<i class="fas fa-circle-notch fa-spin text-sky-500 text-3xl mb-4"></i>
<p class="text-slate-400 text-xs font-bold uppercase">Lecture des donnÃ©es satellites...</p>
</div>
</div>

<div class="mt-10 p-6 glass-card text-center bg-white/5 border-dashed border-sky-500/40">
<p class="text-[10px] font-black text-sky-400 mb-4 uppercase">Partager l'application</p>
<div class="flex justify-center bg-white p-2 rounded-2xl w-36 mx-auto shadow-2xl">
<img src="https://api.qrserver.com/v1/create-qr-code/?size=140x140&data=https://doundou969.github.io/sunu-blue-tech/" alt="QR Code">
</div>
<p class="mt-4 text-[9px] text-slate-500 italic uppercase">Scanner pour ouvrir sur mobile</p>
</div>

<footer class="mt-12 text-center text-slate-600 text-[9px] pb-10 uppercase font-bold tracking-widest">
<p>&copy; 2026 PecheurConnect - Marine Data Senegal</p>
</footer>

<script>
const DATA_URL = "data.json"; // fichier gÃ©nÃ©rÃ© par script_peche.py

const map = L.map('map', {tap:false, zoomControl:true}).setView([14.5, -17.2],7);
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

const zonesCoords = {
"SAINT-LOUIS":[16.03,-16.50],"LOUGA-POTOU":[15.48,-16.75],
"KAYAR":[14.92,-17.20],"DAKAR-YOFF":[14.75,-17.48],
"MBOUR-JOAL":[14.41,-16.96],"CASAMANCE":[12.50,-16.70]
};

async function updateDashboard(){
    const container=document.getElementById('dashboard');
    try{
        const res = await fetch(DATA_URL+'?t='+Date.now());
        if(!res.ok) throw new Error();
        const data = await res.json();
        container.innerHTML='';
        data.forEach(item=>{
            const danger=item.houle>=2.2;
            const card=document.createElement('div');
            card.className=`glass-card p-5 ${danger?'danger-pulse':''}`;
            card.innerHTML=`
                <div class="flex justify-between items-start mb-3">
                    <h3 class="text-base font-black uppercase tracking-tight">${item.zone}</h3>
                    <span class="text-xl">${item.alert}</span>
                </div>
                <div class="flex justify-between items-end">
                    <div>
                        <span class="text-3xl font-mono font-bold">${item.sst}Â°C</span>
                        <span class="text-sm ml-1">${item.trend||''}</span>
                    </div>
                    <div class="text-right">
                        <p class="text-[8px] text-slate-500 font-black uppercase">Houle</p>
                        <p class="text-xl font-bold ${danger?'text-red-500':'text-emerald-400'}">${item.houle} m</p>
                    </div>
                </div>
                <div class="mt-4 pt-3 border-t border-slate-800/50 flex justify-between text-[10px] text-slate-400 font-bold uppercase">
                    <span>ğŸŒ€ ${item.courant} m/s ${item.wind_dir}</span>
                </div>
            `;
            container.appendChild(card);

            if(zonesCoords[item.zone]){
                L.circleMarker(zonesCoords[item.zone],{
                    radius:10, fillColor: danger?'#ef4444':'#0ea5e9',
                    color:"#fff", weight:2, fillOpacity:0.9
                }).addTo(map);
            }
        });
    }catch(err){
        container.innerHTML='<p class="col-span-full text-center text-slate-500 text-[10px] p-10 font-bold uppercase tracking-widest italic">En attente des satellites... (VÃ©rifiez votre connexion)</p>';
    }
}

function getUserLocation(){
    navigator.geolocation.getCurrentPosition(p=>{
        const loc=[p.coords.latitude,p.coords.longitude];
        L.marker(loc).addTo(map).bindPopup("Ma Pirogue").openPopup();
        map.setView(loc,10);
    },()=>alert("Activez le GPS"));
}

window.onload=updateDashboard;

// --- REGISTER SERVICE WORKER (PWA) ---
if('serviceWorker' in navigator){
    navigator.serviceWorker.register('sw.js').then(()=>console.log("âœ… SW actif")).catch(e=>console.log("âŒ SW erreur:",e));
}
</script>
</body>
</html>
