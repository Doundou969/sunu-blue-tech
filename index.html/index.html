<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PecheurConnect üá∏üá≥</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon-192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body { background:#020617; color:white; }
        #map { height:350px; border-radius:16px; border: 2px solid #1e293b; }
        .zone-card { transition: transform 0.2s; }
        .zone-card:hover { transform: scale(1.02); }
    </style>
</head>

<body class="p-4 max-w-4xl mx-auto">

    <header class="text-center mb-6">
        <h1 class="text-3xl font-black text-sky-400">PECHEUR CONNECT üá∏üá≥</h1>
        <p class="text-slate-400 text-xs uppercase tracking-widest mt-1">Surveillance Maritime S√©n√©gal</p>
    </header>

    <div id="map" class="mb-6 shadow-2xl shadow-blue-900/20"></div>
    
    <div id="dashboard" class="grid gap-4 sm:grid-cols-2">
        </div>

    <script>
        // Initialisation de la carte
        const map = L.map('map').setView([14.5, -16.8], 7);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        // Chargement des donn√©es avec gestion d'erreur robuste
        // On utilise le nom direct du fichier
        fetch("data.json?t=" + Date.now())
            .then(r => {
                if (!r.ok) throw new Error("Fichier data.json non trouv√© (404)");
                return r.json();
            })
            .then(data => {
                const dash = document.getElementById("dashboard");
                dash.innerHTML = "";

                data.forEach(z => {
                    const isDanger = z.vhm0 >= 2.2;
                    const color = isDanger ? "#ef4444" : "#22d3ee";

                    // 1. Cr√©ation de la carte dans le dashboard
                    const card = document.createElement("div");
                    card.className = `p-4 rounded-xl bg-slate-800/50 border-l-4 zone-card ${isDanger ? 'border-red-500' : 'border-cyan-500'}`;
                    card.innerHTML = `
                        <div class="flex justify-between items-start">
                            <b class="text-lg">${z.zone}</b>
                            <span class="font-bold ${isDanger ? 'text-red-500' : 'text-cyan-400'}">${z.alert}</span>
                        </div>
                        <div class="mt-2 text-sm text-slate-300">
                            <p>üåä Houle : <b>${z.vhm0} m</b> ${z.trend}</p>
                            <p>üå°Ô∏è Temp : <b>${z.temp} ¬∞C</b></p>
                            <p>üí® Vent : <b>${z.wind_speed} km/h (${z.wind_dir})</b></p>
                        </div>
                        <div class="mt-2 text-[10px] text-slate-500 italic">M√†J: ${z.timestamp.split('T')[1].split('.')[0]}</div>
                    `;
                    dash.appendChild(card);

                    // 2. Ajout du marqueur sur la carte
                    if (z.lat && z.lon) {
                        L.circleMarker([z.lat, z.lon], {
                            radius: 10,
                            color: "#fff",
                            weight: 1,
                            fillColor: color,
                            fillOpacity: 0.8
                        }).addTo(map).bindPopup(`<b>${z.zone}</b><br>Houle: ${z.vhm0}m<br>${z.alert}`);
                    }
                });
            })
            .catch(err => {
                console.error(err);
                document.getElementById("dashboard").innerHTML = `
                    <div class="col-span-full p-6 bg-red-900/20 border border-red-500 rounded-xl text-center">
                        <p class="text-red-400 font-bold">‚ö†Ô∏è Erreur de chargement</p>
                        <p class="text-xs text-slate-400">V√©rifiez que data.json est bien √† la racine de votre d√©p√¥t GitHub.</p>
                    </div>
                `;
            });

        // Service Worker pour le mode PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register("sw.js").catch(e => console.log(e));
        }
    </script>
</body>
</html>
