<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PecheurConnect üá∏üá≥</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --main-blue: #0056b3; --danger-red: #d9534f; --safe-green: #28a745; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        #map { height: 100vh; width: 100%; z-index: 1; }
        
        .top-bar {
            position: absolute; top: 10px; left: 10px; right: 10px; z-index: 1000;
            background: white; padding: 12px; border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex;
            justify-content: space-between; align-items: center; border-bottom: 3px solid var(--main-blue);
        }
        .top-bar h1 { margin: 0; font-size: 16px; color: var(--main-blue); }
        .last-update { font-size: 10px; color: #666; }

        .legend {
            position: absolute; bottom: 20px; left: 10px; z-index: 1000;
            background: rgba(255,255,255,0.9); padding: 8px; border-radius: 6px; font-size: 11px;
        }
        .status-dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }

        /* Style des bulles sur la carte */
        .wave-badge {
            color: white; padding: 4px 8px; border-radius: 12px;
            font-weight: bold; font-size: 12px; border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3); text-align: center;
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <h1>üá∏üá≥ PecheurConnect</h1>
        <div id="meta-info" class="last-update">Chargement...</div>
    </div>

    <div class="legend">
        <div><span class="status-dot" style="background:var(--safe-green)"></span> Sortie Autoris√©e</div>
        <div><span class="status-dot" style="background:var(--danger-red)"></span> Vigilance Requise</div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        window.onload = function() {
            const map = L.map('map', { zoomControl: false }).setView([14.45, -17.2], 7);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            L.control.zoom({ position: 'bottomright' }).addTo(map);

            fetch('./data.json?v=' + Date.now())
                .then(res => res.json())
                .then(data => {
                    document.getElementById('meta-info').innerHTML = "Donn√©es : " + data[0].date;
                    
                    data.forEach(item => {
                        const isDanger = item.safety.includes("DANGER");
                        const color = isDanger ? "#d9534f" : "#28a745";

                        L.marker([item.lat, item.lon], {
                            icon: L.divIcon({
                                className: 'custom-div-icon',
                                html: `<div class="wave-badge" style="background:${color}">${item.v_now}m</div>`,
                                iconSize: [50, 25]
                            })
                        })
                        .addTo(map)
                        .bindPopup(`
                            <div style="font-size:14px; line-height:1.6;">
                                <b style="font-size:16px; color:#333;">üìç ${item.zone}</b><br>
                                <hr style="border:0; border-top:1px solid #eee;">
                                üåä Vagues : <b>${item.v_now}m</b><br>
                                üå°Ô∏è Temp√©rature : <b>${item.t_now}¬∞C</b><br>
                                üß≠ Courant : <b>${item.c_now}m/s</b><br>
                                üêü P√™che : <b>${item.index}</b><br>
                                <div style="margin-top:8px; padding:5px; border-radius:4px; background:${color}; color:white; text-align:center; font-weight:bold;">
                                    ${item.safety}
                                </div>
                            </div>
                        `);
                    });
                });
        };
    </script>
</body>
</html>
