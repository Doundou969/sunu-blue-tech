<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PecheurConnect PRO ğŸ‡¸ğŸ‡³</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { 
            --bg: #f4f7f6; --text: #2c3e50; --panel: rgba(255,255,255,0.9);
            --primary: #0056b3; --whatsapp: #25D366;
        }
        /* Mode Nuit Automatique */
        @media (prefers-color-scheme: dark) {
            :root { --bg: #1a1a1a; --text: #ecf0f1; --panel: rgba(44, 62, 80, 0.9); }
        }

        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); }
        #map { height: 100vh; width: 100%; }

        /* SÃ©lecteur de prÃ©visions */
        .forecast-selector {
            position: absolute; top: 85px; left: 15px; z-index: 1000;
            display: flex; gap: 5px; background: var(--panel); padding: 5px; border-radius: 20px;
        }
        .day-btn { 
            border: none; padding: 8px 15px; border-radius: 15px; cursor: pointer;
            background: transparent; color: var(--text); font-weight: bold;
        }
        .day-btn.active { background: var(--primary); color: white; }

        /* Calculateur de carburant */
        .fuel-calc {
            margin-top: 10px; padding: 10px; background: #eef2f3; border-radius: 8px; color: #333; font-size: 11px;
        }
        
        .whatsapp-btn { position: absolute; bottom: 30px; right: 20px; z-index: 1000; background: var(--whatsapp); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; }
    </style>
</head>
<body>

    <div class="search-container" style="position: absolute; top: 15px; left: 15px; right: 15px; z-index: 1000; max-width: 400px;">
        <div style="background: white; padding: 10px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: flex; align-items: center;">
            <h2 style="margin:0; font-size:16px;">ğŸ‡¸ğŸ‡³ PecheurConnect PRO</h2>
        </div>
    </div>

    <div class="forecast-selector">
        <button class="day-btn active" onclick="changeDay(0)">Aujourd'hui</button>
        <button class="day-btn" onclick="changeDay(1)">Demain</button>
        <button class="day-btn" onclick="changeDay(2)">J+2</button>
    </div>

    <div id="map"></div>

    <div class="whatsapp-btn" onclick="window.open('https://wa.me/221XXXXXXXXX')">ğŸ“¢</div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let currentDay = 0;
        let globalData = [];
        const map = L.map('map', { zoomControl: false }).setView([14.45, -17.2], 7);
        const markerGroup = L.layerGroup().addTo(map);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

        function loadData() {
            fetch('./data.json?v=' + Date.now())
                .then(res => res.json())
                .then(data => {
                    globalData = data;
                    renderMarkers();
                });
        }

        function renderMarkers() {
            markerGroup.clearLayers();
            globalData.forEach(item => {
                const dayData = item.forecasts[currentDay];
                const color = dayData.safety.includes("ğŸ”´") ? "#d9534f" : "#28a745";
                
                // Calcul de carburant simplifiÃ© : conso de base + (0.5L par 0.1m de vague)
                const fuelEst = 20 + (dayData.v_now * 5);

                const marker = L.marker([item.lat, item.lon], {
                    icon: L.divIcon({
                        className: 'custom',
                        html: `<div style="background:${color}; color:white; padding:5px; border-radius:10px; font-weight:bold; border:2px solid white; width:50px; text-align:center;">${dayData.v_now}m</div>`
                    })
                }).addTo(markerGroup);

                marker.bindPopup(`
                    <b>ğŸ“ ${item.zone} (${dayData.jour})</b><br>
                    ğŸŒŠ Vagues : ${dayData.v_now}m<br>
                    ğŸŸ PÃªche : ${dayData.index}<br>
                    <div class="fuel-calc">
                        â›½ Est. Carburant : <b>~${fuelEst.toFixed(1)} Litres</b><br>
                        (BasÃ© sur courant/vagues)
                    </div>
                `);
            });
        }

        function changeDay(day) {
            currentDay = day;
            document.querySelectorAll('.day-btn').forEach((btn, idx) => {
                btn.classList.toggle('active', idx === day);
            });
            renderMarkers();
        }

        loadData();
    </script>
</body>
</html>
