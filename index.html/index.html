<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PecheurConnect ğŸ‡¸ğŸ‡³ | SÃ©curitÃ© Maritime</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #0056b3; --danger: #d9534f; --safe: #28a745; --dark: #2c3e50; }
        body { margin: 0; font-family: 'Segoe UI', Roboto, sans-serif; overflow: hidden; }
        
        #map { height: 100vh; width: 100%; z-index: 1; }

        /* Barre de Recherche et Titre */
        .search-container {
            position: absolute; top: 15px; left: 15px; right: 15px; z-index: 1000;
            max-width: 400px;
        }
        .search-box {
            width: 100%; padding: 12px 15px; border-radius: 25px; border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 16px; outline: none;
        }

        .brand-header {
            background: white; margin-bottom: 10px; padding: 10px 20px;
            border-radius: 15px; display: flex; align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-bottom: 4px solid var(--primary);
        }
        .brand-header img { height: 30px; margin-right: 10px; }
        .brand-header h1 { margin: 0; font-size: 18px; color: var(--dark); }

        /* LÃ©gende flottante */
        .info-panel {
            position: absolute; bottom: 30px; left: 15px; z-index: 1000;
            background: white; padding: 12px; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 12px;
        }

        /* Style des badges sur la carte */
        .wave-badge {
            color: white; padding: 5px 10px; border-radius: 15px;
            font-weight: bold; font-size: 12px; border: 2px solid white;
            box-shadow: 0 3px 8px rgba(0,0,0,0.4); text-align: center;
            min-width: 50px; cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="search-container">
        <div class="brand-header">
            <h1>ğŸ‡¸ğŸ‡³ PecheurConnect</h1>
        </div>
        <input type="text" id="zoneSearch" class="search-box" placeholder="ğŸ” Rechercher un port (ex: Kayar)...">
    </div>

    <div class="info-panel">
        <div id="update-tag" style="color:#666; margin-bottom:8px; font-weight:bold;">Mise Ã  jour : --:--</div>
        <div style="display:flex; gap:10px;">
            <span><b style="color:var(--safe)">â—</b> SÃ»r</span>
            <span><b style="color:var(--danger)">â—</b> Danger</span>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const map = L.map('map', { zoomControl: false }).setView([14.45, -17.2], 7);
            const markers = [];

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            L.control.zoom({ position: 'bottomright' }).addTo(map);

            // Fonction pour charger les donnÃ©es
            fetch('./data.json?v=' + Date.now())
                .then(res => res.json())
                .then(data => {
                    document.getElementById('update-tag').innerText = "Mise Ã  jour : " + data[0].date;

                    data.forEach(item => {
                        const isDanger = item.safety.includes("ğŸ”´");
                        const color = isDanger ? "#d9534f" : "#28a745";

                        const marker = L.marker([item.lat, item.lon], {
                            icon: L.divIcon({
                                className: 'custom-div-icon',
                                html: `<div class="wave-badge" style="background:${color}">${item.v_now}m</div>`,
                                iconSize: [65, 30]
                            })
                        }).addTo(map);

                        marker.bindPopup(`
                            <div style="min-width:160px;">
                                <h3 style="margin:0 0 10px 0; color:var(--dark)">ğŸ“ ${item.zone}</h3>
                                <b>ğŸŒŠ Vagues :</b> ${item.v_now}m<br>
                                <b>ğŸŒ¡ï¸ Mer :</b> ${item.t_now}Â°C<br>
                                <b>ğŸ§­ Courant :</b> ${item.c_now}m/s<br>
                                <b>ğŸŸ PÃªche :</b> ${item.index}<br>
                                <div style="margin-top:10px; padding:6px; border-radius:5px; background:${color}; color:white; text-align:center; font-weight:bold;">
                                    ${item.safety}
                                </div>
                            </div>
                        `);

                        // On stocke le marqueur et le nom de la zone pour la recherche
                        markers.push({ name: item.zone.toLowerCase(), marker: marker, latlng: [item.lat, item.lon] });
                    });
                });

            // Logique de recherche
            document.getElementById('zoneSearch').addEventListener('input', function(e) {
                const search = e.target.value.toLowerCase();
                const found = markers.find(m => m.name.includes(search));
                if (found && search.length > 2) {
                    map.flyTo(found.latlng, 10);
                    found.marker.openPopup();
                }
            });
        });
    </script>
</body>
</html>
