<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PecheurConnect üá∏üá≥ | S√©curit√© Maritime</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        :root { 
            --primary: #0056b3; 
            --danger: #d9534f; 
            --safe: #28a745; 
            --dark: #2c3e50;
            --whatsapp: #25D366;
        }

        body { margin: 0; font-family: 'Segoe UI', Roboto, sans-serif; overflow: hidden; background: #f4f7f6; }
        #map { height: 100vh; width: 100%; z-index: 1; }

        /* Barre de Recherche et En-t√™te */
        .search-container {
            position: absolute; top: 15px; left: 15px; right: 15px; z-index: 1000;
            max-width: 400px;
        }
        .brand-header {
            background: white; margin-bottom: 10px; padding: 12px 20px;
            border-radius: 12px; display: flex; align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-left: 5px solid var(--primary);
        }
        .brand-header h1 { margin: 0; font-size: 18px; color: var(--dark); font-weight: 800; }

        .search-box {
            width: 100%; padding: 12px 20px; border-radius: 25px; border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); font-size: 16px; outline: none;
            box-sizing: border-box;
        }

        /* Panneau d'information */
        .info-panel {
            position: absolute; bottom: 30px; left: 15px; z-index: 1000;
            background: rgba(255, 255, 255, 0.95); padding: 15px; border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 12px;
            backdrop-filter: blur(5px);
        }
        .status-legend { display: flex; gap: 15px; margin-top: 5px; }

        /* Badge des Vagues sur la Carte */
        .wave-badge {
            color: white; padding: 5px 10px; border-radius: 20px;
            font-weight: bold; font-size: 12px; border: 2px solid white;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3); text-align: center;
            min-width: 55px;
        }

        /* Bouton WhatsApp Flottant */
        .whatsapp-btn {
            position: absolute; bottom: 30px; right: 20px; z-index: 1000;
            background: var(--whatsapp); color: white; width: 60px; height: 60px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .whatsapp-btn:hover { transform: scale(1.1); }
        .whatsapp-btn svg { width: 32px; height: 32px; fill: white; }

        /* Popup Styling */
        .leaflet-popup-content-wrapper { border-radius: 12px; padding: 5px; }
        .popup-title { border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 8px; font-size: 16px; }
    </style>
</head>
<body>

    <div class="search-container">
        <div class="brand-header">
            <h1>üá∏üá≥ PecheurConnect</h1>
        </div>
        <input type="text" id="zoneSearch" class="search-box" placeholder="üîç Chercher un port (Kayar, Ndar...)">
    </div>

    <div class="info-panel">
        <div id="update-tag" style="color:var(--primary); font-weight:bold; margin-bottom:5px;">Mise √† jour : --:--</div>
        <div class="status-legend">
            <span><b style="color:var(--safe)">‚óè</b> S√ªr</span>
            <span><b style="color:var(--danger)">‚óè</b> Danger</span>
        </div>
    </div>

    <div class="whatsapp-btn" onclick="openWhatsAppReport()" title="Signaler un danger">
        <svg viewBox="0 0 24 24"><path d="M12.031 6.172c-2.32 0-4.591 1.342-5.467 3.398-.19.447-.442 1.397-.442 2.43 0 1.258.423 2.185.834 2.893l-.75 2.15 2.222-.72c.607.35 1.417.618 2.204.618 2.32 0 4.59-1.342 5.466-3.397.876-2.056.463-4.11-.96-5.353-.96-.842-1.802-1.02-3.107-1.02zm-2.015 7.15c-.18 0-.324-.045-.434-.135s-.166-.215-.166-.374c0-.158.056-.285.166-.38s.255-.143.434-.143c.18 0 .324.048.434.143s.166.222.166.38c0 .16-.056.284-.166.374s-.255.135-.434.135zm2.844 0c-.18 0-.324-.045-.434-.135s-.166-.215-.166-.374c0-.158.056-.285.166-.38s.255-.143.434-.143c.18 0 .324.048.434.143s.166.222.166.38c0 .16-.056.284-.166.374s-.255.135-.434.135z"/></svg>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Initialisation de la carte centr√©e sur le S√©n√©gal
            const map = L.map('map', { zoomControl: false }).setView([14.45, -17.2], 7);
            const markers = [];

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap | PecheurConnect'
            }).addTo(map);

            L.control.zoom({ position: 'bottomright' }).addTo(map);

            // Chargement des donn√©es JSON
            fetch('./data.json?v=' + Date.now())
                .then(res => res.json())
                .then(data => {
                    // Mise √† jour de l'heure
                    document.getElementById('update-tag').innerText = "Mise √† jour : " + (data[0].date || "En cours");

                    data.forEach(item => {
                        const isDanger = (item.safety || "").includes("üî¥");
                        const color = isDanger ? "#d9534f" : "#28a745";

                        const marker = L.marker([item.lat, item.lon], {
                            icon: L.divIcon({
                                className: 'custom-div-icon',
                                html: `<div class="wave-badge" style="background:${color}">${item.v_now}m</div>`,
                                iconSize: [65, 30]
                            })
                        }).addTo(map);

                        const popupContent = `
                            <div style="min-width:180px;">
                                <div class="popup-title"><b style="color:var(--primary)">üìç ${item.zone}</b></div>
                                üåä <b>Vagues :</b> ${item.v_now}m<br>
                                üå°Ô∏è <b>Temp√©rature :</b> ${item.t_now}¬∞C<br>
                                üß≠ <b>Courant :</b> ${item.c_now}m/s<br>
                                üêü <b>P√™che :</b> ${item.index}<br>
                                <div style="margin-top:10px; padding:8px; border-radius:6px; background:${color}; color:white; text-align:center; font-weight:bold;">
                                    ${item.safety}
                                </div>
                            </div>
                        `;
                        
                        marker.bindPopup(popupContent);
                        markers.push({ name: item.zone.toLowerCase(), marker: marker, latlng: [item.lat, item.lon] });
                    });
                })
                .catch(err => console.error("Erreur chargement donn√©es:", err));

            // Logique de recherche dynamique
            document.getElementById('zoneSearch').addEventListener('input', function(e) {
                const search = e.target.value.toLowerCase();
                const found = markers.find(m => m.name.includes(search));
                if (found && search.length > 2) {
                    map.flyTo(found.latlng, 10);
                    found.marker.openPopup();
                }
            });
        });

        // Fonction WhatsApp
        function openWhatsAppReport() {
            const phoneNumber = "221777020818"; // REMPLACER PAR VOTRE NUM√âRO
            const message = encodeURIComponent("üì¢ *SIGNALEMENT PECHEURCONNECT*\n\nJe signale un changement en mer :\n\nüìç Zone : \nüåä √âtat : \n‚ö†Ô∏è Commentaire : ");
            window.open(`https://wa.me/${phoneNumber}?text=${message}`, '_blank');
        }
    </script>
</body>
</html>
