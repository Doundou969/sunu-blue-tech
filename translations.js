/**
 * PecheurConnect v3.0 - Système de traduction
 * Langues supportées : Français, Wolof, English
 */

const translations = {
    // ================================================================
    // FRANÇAIS
    // ================================================================
    fr: {
        // Navigation
        home: "Accueil",
        map: "Carte",
        history: "Historique",
        compare: "Comparateur",
        export: "Export",
        alerts: "Alertes",
        admin: "Admin",
        api: "API",
        settings: "Paramètres",
        
        // Sécurité
        safe: "Sûr",
        caution: "Vigilance",
        warning: "Prudence",
        danger: "Danger",
        
        // Météo & Océan
        waves: "Vagues",
        temperature: "Température",
        current: "Courant",
        wind: "Vent",
        visibility: "Visibilité",
        humidity: "Humidité",
        precipitation: "Précipitations",
        pressure: "Pression",
        clouds: "Nuages",
        weather: "Météo",
        
        // Pêche
        fish_index: "Indice Pêche",
        excellent: "Excellent",
        good: "Bon",
        moderate: "Moyen",
        poor: "Faible",
        
        // Actions
        go_out: "Sortir",
        stay_home: "Rester",
        be_careful: "Attention",
        refresh: "Actualiser",
        install: "Installer",
        share: "Partager",
        download: "Télécharger",
        
        // Recommandations
        do_not_go_out: "NE PAS SORTIR EN MER",
        stay_near_coast: "Restez près des côtes",
        safe_conditions: "Conditions sûres pour la navigation",
        optimal_fishing: "Conditions OPTIMALES pour la pêche",
        good_fishing: "Bonnes conditions de pêche",
        moderate_conditions: "Conditions moyennes",
        
        // Temps
        today: "Aujourd'hui",
        yesterday: "Hier",
        tomorrow: "Demain",
        this_week: "Cette semaine",
        last_7_days: "7 derniers jours",
        last_30_days: "30 derniers jours",
        
        // Interface
        loading: "Chargement",
        error: "Erreur",
        no_data: "Aucune donnée",
        updated: "Mis à jour",
        zones: "zones",
        regions: "régions",
        search: "Rechercher",
        filter: "Filtrer",
        select_zone: "Sélectionner une zone",
        all: "Tout",
        
        // Comparateur
        where_to_fish: "Où pêcher aujourd'hui ?",
        best_zone: "Meilleure zone",
        score: "Score",
        distance: "Distance",
        reasons: "Raisons",
        recommendation: "Recommandation",
        
        // Alertes
        enable_alerts: "Activer les alertes",
        alert_types: "Types d'alertes",
        zones_to_watch: "Zones à surveiller",
        save_settings: "Sauvegarder",
        notifications: "Notifications",
        
        // Stats
        statistics: "Statistiques",
        trend: "Tendance",
        average: "Moyenne",
        minimum: "Minimum",
        maximum: "Maximum",
        total: "Total",
        
        // Régions
        nord: "Nord",
        grande_cote: "Grande Côte",
        dakar: "Dakar",
        petite_cote: "Petite Côte",
        sine_saloum: "Sine Saloum",
        casamance: "Casamance"
    },
    
    // ================================================================
    // WOLOF
    // ================================================================
    wo: {
        // Navigation
        home: "Kër",
        map: "Kàrt",
        history: "Jaar-jaar",
        compare: "Wuute",
        export: "Génne",
        alerts: "Yéenekaay",
        admin: "Boroom",
        api: "API",
        settings: "Paramètr",
        
        // Sécurité
        safe: "Baax",
        caution: "Seet",
        warning: "Bàyyi",
        danger: "Ñax",
        
        // Météo & Océan
        waves: "Ndox",
        temperature: "Tangoor",
        current: "Dëkk ndox",
        wind: "Gàmmu",
        visibility: "Gis",
        humidity: "Ndaw",
        precipitation: "Taw",
        pressure: "Bokk",
        clouds: "Taawan",
        weather: "Yaram",
        
        // Pêche
        fish_index: "Liggéey jën",
        excellent: "Rafet na lool",
        good: "Baax na",
        moderate: "Mu neex",
        poor: "Muñ",
        
        // Actions
        go_out: "Génn",
        stay_home: "Toog",
        be_careful: "Seet",
        refresh: "Yéesal",
        install: "Lajjal",
        share: "Bokk",
        download: "Téléye",
        
        // Recommandations
        do_not_go_out: "BUL GÉNN CI GÉEJ",
        stay_near_coast: "Toog ci buntu géej",
        safe_conditions: "Dëkk baax na ngir génn",
        optimal_fishing: "Dëkk RAFET na ngir jën",
        good_fishing: "Jëfandoo na ngir jën",
        moderate_conditions: "Dëkk am na ci",
        
        // Temps
        today: "Tay",
        yesterday: "Démb",
        tomorrow: "Suba",
        this_week: "Ayu-bis bii",
        last_7_days: "7 fan ñépp",
        last_30_days: "30 fan ñépp",
        
        // Interface
        loading: "Yégël",
        error: "Njumte",
        no_data: "Amul",
        updated: "Yéesal",
        zones: "bër",
        regions: "jëf",
        search: "Seet",
        filter: "Tëj",
        select_zone: "Tànn benn bër",
        all: "Lépp",
        
        // Comparateur
        where_to_fish: "Fan ngay jën tey?",
        best_zone: "Bër bu baax",
        score: "Liggéey",
        distance: "Wëral",
        reasons: "Dëgg-dëgg",
        recommendation: "Waxtaan",
        
        // Alertes
        enable_alerts: "Lajjal yéenekaay",
        alert_types: "Sàmm yéenekaay",
        zones_to_watch: "Bër ngay gis",
        save_settings: "Dugg",
        notifications: "Yéenekaay",
        
        // Stats
        statistics: "Liggéey",
        trend: "Daw",
        average: "Ci digg",
        minimum: "Ndaw",
        maximum: "Mag",
        total: "Lépp",
        
        // Régions
        nord: "Kaw",
        grande_cote: "Njàkk bu mag",
        dakar: "Ndakaaru",
        petite_cote: "Njàkk bu ndaw",
        sine_saloum: "Siin-Saluum",
        casamance: "Kasamaans"
    },
    
    // ================================================================
    // ENGLISH
    // ================================================================
    en: {
        // Navigation
        home: "Home",
        map: "Map",
        history: "History",
        compare: "Compare",
        export: "Export",
        alerts: "Alerts",
        admin: "Admin",
        api: "API",
        settings: "Settings",
        
        // Sécurité
        safe: "Safe",
        caution: "Caution",
        warning: "Warning",
        danger: "Danger",
        
        // Météo & Océan
        waves: "Waves",
        temperature: "Temperature",
        current: "Current",
        wind: "Wind",
        visibility: "Visibility",
        humidity: "Humidity",
        precipitation: "Precipitation",
        pressure: "Pressure",
        clouds: "Clouds",
        weather: "Weather",
        
        // Pêche
        fish_index: "Fish Index",
        excellent: "Excellent",
        good: "Good",
        moderate: "Moderate",
        poor: "Poor",
        
        // Actions
        go_out: "Go Out",
        stay_home: "Stay",
        be_careful: "Be Careful",
        refresh: "Refresh",
        install: "Install",
        share: "Share",
        download: "Download",
        
        // Recommandations
        do_not_go_out: "DO NOT GO TO SEA",
        stay_near_coast: "Stay near the coast",
        safe_conditions: "Safe conditions for navigation",
        optimal_fishing: "OPTIMAL fishing conditions",
        good_fishing: "Good fishing conditions",
        moderate_conditions: "Moderate conditions",
        
        // Temps
        today: "Today",
        yesterday: "Yesterday",
        tomorrow: "Tomorrow",
        this_week: "This week",
        last_7_days: "Last 7 days",
        last_30_days: "Last 30 days",
        
        // Interface
        loading: "Loading",
        error: "Error",
        no_data: "No data",
        updated: "Updated",
        zones: "zones",
        regions: "regions",
        search: "Search",
        filter: "Filter",
        select_zone: "Select a zone",
        all: "All",
        
        // Comparateur
        where_to_fish: "Where to fish today?",
        best_zone: "Best zone",
        score: "Score",
        distance: "Distance",
        reasons: "Reasons",
        recommendation: "Recommendation",
        
        // Alertes
        enable_alerts: "Enable alerts",
        alert_types: "Alert types",
        zones_to_watch: "Zones to watch",
        save_settings: "Save settings",
        notifications: "Notifications",
        
        // Stats
        statistics: "Statistics",
        trend: "Trend",
        average: "Average",
        minimum: "Minimum",
        maximum: "Maximum",
        total: "Total",
        
        // Régions
        nord: "North",
        grande_cote: "Great Coast",
        dakar: "Dakar",
        petite_cote: "Little Coast",
        sine_saloum: "Sine Saloum",
        casamance: "Casamance"
    }
};

// ================================================================
// CLASSE LANGUAGE MANAGER
// ================================================================
class LanguageManager {
    constructor() {
        this.currentLanguage = this.loadLanguage();
        this.listeners = new Set();
    }
    
    loadLanguage() {
        const saved = localStorage.getItem('pecheurconnect_language');
        
        // Détecter langue navigateur si pas de préférence
        if (!saved) {
            const browserLang = navigator.language.split('-')[0];
            if (translations[browserLang]) {
                return browserLang;
            }
        }
        
        return saved || 'fr';
    }
    
    setLanguage(lang) {
        if (!translations[lang]) {
            console.error('Langue non supportée:', lang);
            return false;
        }
        
        this.currentLanguage = lang;
        localStorage.setItem('pecheurconnect_language', lang);
        
        // Mettre à jour l'attribut lang du document
        document.documentElement.lang = this.getLangCode(lang);
        
        // Notifier les listeners
        this.listeners.forEach(callback => callback(lang));
        
        // Appliquer les traductions
        this.applyTranslations();
        
        return true;
    }
    
    getLangCode(lang) {
        const codes = { fr: 'fr-FR', wo: 'wo-SN', en: 'en-US' };
        return codes[lang] || 'fr-FR';
    }
    
    translate(key, params = {}) {
        const translation = translations[this.currentLanguage][key];
        
        if (!translation) {
            // Fallback français
            return translations['fr'][key] || key;
        }
        
        // Remplacer paramètres {{param}}
        let result = translation;
        Object.keys(params).forEach(param => {
            result = result.replace(new RegExp(`{{${param}}}`, 'g'), params[param]);
        });
        
        return result;
    }
    
    t(key, params) {
        return this.translate(key, params);
    }
    
    applyTranslations() {
        // Traduire tous les éléments avec data-i18n
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            const translation = this.translate(key);
            
            // Gérer différents types d'éléments
            if (element.tagName === 'INPUT' && element.placeholder !== undefined) {
                element.placeholder = translation;
            } else if (element.tagName === 'IMG' && element.alt !== undefined) {
                element.alt = translation;
            } else {
                element.textContent = translation;
            }
        });
        
        // Traduire attributs title
        document.querySelectorAll('[data-i18n-title]').forEach(element => {
            const key = element.getAttribute('data-i18n-title');
            element.title = this.translate(key);
        });
    }
    
    onChange(callback) {
        this.listeners.add(callback);
        return () => this.listeners.delete(callback);
    }
    
    getCurrentLanguage() {
        return this.currentLanguage;
    }
    
    getAvailableLanguages() {
        return Object.keys(translations);
    }
    
    formatNumber(number, decimals = 0) {
        const locales = { fr: 'fr-FR', wo: 'fr-FR', en: 'en-US' };
        return new Intl.NumberFormat(locales[this.currentLanguage], {
            minimumFractionDigits: decimals,
            maximumFractionDigits: decimals
        }).format(number);
    }
    
    formatDate(date, format = 'short') {
        const locales = { fr: 'fr-FR', wo: 'fr-FR', en: 'en-US' };
        
        const options = {
            short: { day: '2-digit', month: '2-digit', year: 'numeric' },
            long: { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' },
            time: { hour: '2-digit', minute: '2-digit' }
        };
        
        return new Intl.DateTimeFormat(locales[this.currentLanguage], options[format]).format(date);
    }
}

// ================================================================
// INSTANCE GLOBALE
// ================================================================
const langManager = new LanguageManager();

// Fonction helper globale
function t(key, params) {
    return langManager.translate(key, params);
}

// Appliquer traductions au chargement
document.addEventListener('DOMContentLoaded', () => {
    langManager.applyTranslations();
});

// Export pour modules
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { LanguageManager, translations, langManager, t };
}
